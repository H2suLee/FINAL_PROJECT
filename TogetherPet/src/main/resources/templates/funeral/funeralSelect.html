<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/layout2}">
<head>
<meta charset="UTF-8">

<style>

.photo {
	height: 1000px;
}

#d5>div:nth-child(2) {
	white-space: pre-line;
	text-align: center;
}

span {
	font-size: 30px;
}

.review-comment-list {
	display: flex;
	justify-content: flex-start;
	flex-direction: column;
	background-color: #fff;
	padding: 15px 40px 15px 40px;
	border-radius: 5px;
}

.review-comment {
	display: flex;
	justify-content: flex-start;
	flex-direction: column;
	align-items: flex-end;
}

.comment-item {
	display: flex;
	justify-content: flex-start;
	align-items: center;
	margin: 10px 0 15px;
}

.review-comment-list .comment-info {
	width: 30px;
	margin-right: 16px;
}

.class-review-content .review-comment-list .user-img {
	width: 30px;
	height: 30px;
}

.class-review-content .review-comment-list .comment-text {
	width: 654px;
	font-size: 14px;
	color: #666;
}

span.user-review-info {
	display: inline-block;
	margin-right: 10px;
	font-size: 15px;
	font-weight: 700;
	color: #444;
}

.comment-delete {
	color: #999;
}

.comment-menu {
	margin-top: 5px;
}

.comment-menu>span, .comment-menu>a {
	display: inline-block;
	margin-right: 10px;
	font-size: 13px;
	color: #777;
}

.comment-menu>span {
	font-weight: 500;
}

.comment-menu>a {
	font-weight: 600;
}

.comment-menu>.write-re-comment-btn {
	color: #ff385c;
}

.comment-menu>a.comment-delete {
	font-weight: 500;
	color: #aaa;
}

.review-comment-write {
	display: flex;
	justify-content: flex-start;
	align-items: center;
	width: 700px;
	padding: 0 40px 0 0px;
}

.reviewCommentFrm, .replyFrm {
	display: flex;
	justify-content: flex-start;
	align-items: center;
	width: 700px;
}

.reviewCommentFrm {
	width: 700px;
	margin-top: 25px;
}

.replyFrm {
	margin-bottom: 20px;
	margin-top: 5px;
}

.review-reply {
	width: 590px;
	min-height: 50px;
	border: 1px solid #ddd;
	border-radius: 5px;
	padding: 6px 10px;
	resize: none;
}

.replyFrm>.review-reply {
	width: 545px;
	min-height: 50px;
	border: 1px solid #ddd;
	border-radius: 5px;
	padding: 6px 10px;
}

.review-reply-btn {
	width: 50px;
	height: 36px;
	margin-left: 14px;
	border: none;
	background-color: #000000;
	color: #fff;
	border-radius: 5px;
	cursor: pointer;
}

.btnn {
	text-align: center;
}

/*================ 별점 ===============*/
.star-point:before {
	display: none;
}

.star-point {
	font-size: 54px;
	text-align: center;
	letter-spacing: -3px;
}

.star-point .fa-star {
	cursor: pointer;
	color: #d3d3d3;
}

.star-txt {
	height: 41px;
	padding-top: 8px;
	text-align: center;
	color: #999;
	font-size: 16px;
}

.star-txt>span:first-child {
	color: #ff385c;
	font-size: 27px;
	font-weight: 700;
}

.star-txt>span:nth-child(2) {
	color: #ff385c;
	font-size: 18px;
	font-weight: 700;

}

.reviewstar {
	font-size: xx-large;
	color: #ffd700;
}

</style>


<title>반려동물장례식장</title>

<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://code.jquery.com/ui/1.13.1/jquery-ui.js"></script>
<script>
	/*-----------------------
	//별점 클릭 시 별점 조정	
	-------------------------*/
	$(document).on('click', '.fa-star', function(evt) {
		console.log('실행');
		var idxS = $(this).index();
		console.log(idxS);
		for (var i = 0; i <= idxS; i++) { // 별점 채우기
			$('.star-point').children().eq(i).css('color', '#FFB300');
		}
		for (var i = 4; i > idxS; i--) { // 별점 비우기
			$('.star-point').children().eq(i).css('color', '#d3d3d3');
		}
		$('#star').val(idxS + 1);
		$('.star-txt').html('<span>' + (idxS + 1) + '</span><span>점</span>');

	});
</script>

</head>

<body>
	<article layout:fragment="content">
	<br> <br> <br> <br>
		<!--shop  area start-->


		<!--shop  area start-->
		<div class="shop_section shop_reverse">
			<div class="container">
				<div class="row">
					<div class="col-lg-12 col-md-12">


						<!--breadcrumbs area start-->
						<div class="breadcrumb_content" style="margin: 50px;">
							<ul>
								<li><a href="index.html">home</a></li>
								<li>funeral</li>
								<li>info</li>
							</ul>
						</div>
						<!--breadcrumbs area end-->

						<div class="shop_banner d-flex align-items-center"
							data-bgimg="assets/img/bg/funerlList.jpg">
							<div class="shop_banner_text">
							</div>
						</div>


						<table style="width: 100%;">
							<tbody>


								<tr th:each="f:${funeral}">
									<td
										style="width: 30%; text-align: center; height: 50px; background-color: #eee;">업체명</td>
									<td th:text="${f.name}" style="width: 70%; text-align: center;"><br></td>
								</tr>
								<tr th:each="f:${funeral}">
									<td
										style="width: 30%; text-align: center; height: 50px; background-color: #eee;">주소</td>
									<td th:text="${f.address}"
										style="width: 70%; text-align: center;"><br></td>
								</tr>

								<tr th:each="f:${funeral}">
									<td
										style="width: 30%; text-align: center; height: 50px; background-color: #eee;">전화번호</td>
									<td th:text="${f.call}" style="width: 70%; text-align: center;"><br></td>
								</tr>

								<tr th:each="f:${funeral}" id="all">
									<td
										style="width: 30%; text-align: center; height: 50px; background-color: #eee;">홈페이지</td>
									<td style="width: 70%; text-align: center; font-size: 15px">
										<a th:href="${f.homepage}">[[${f.homepage}]]</a> <input
										type="hidden" th:value="${f.categoryId}" name="categoryId">
										<input type="hidden" th:value="${f.funeralNo}" name="boardNo" id="funeralNo">
										<input type="hidden" th:value="${session.user.userNo}"
										name="userNo"> <br> <br> <img
										class="primary_img" src="assets/img/likes/scrap.jpg"
										alt="consectetur" width="20" height="20">스크랩
									</td>
								</tr>
							</tbody>
						</table>
						<br> <br>


						<!-- 스크랩 스크립트 시작 20221007 소현 추가  -->
						<script>
							var token = $("meta[name='_csrf']").attr("content");
							var header = $("meta[name='_csrf_header']").attr(
									"content");

							//스크랩 하트버튼 클릭시
							$("#all").on(
									'click',
									'.primary_img',
									function() {

										alert('스크랩 하시겠습니까?')

										let categoryId = $('#all').find(
												'input:eq(0)').val();//장례카테고리
										console.log('카테고리->', $('#all').find(
												'input:eq(0)').val());

										let boardNo = $('#all').find(
												'input:eq(1)').val();//boardNo 장례번호
										console.log('장례번호->', $('#all').find(
												'input:eq(1)').val());

										let userNo = $('#all').find(
												'input:eq(2)').val();// userNo 유저번호
										console.log('유저번호->', $('#all').find(
												'input:eq(2)').val());

										//스크랩 등록 처리
										$.ajax({
											url : '/scRapInsert.do',
											type : 'post',
											beforeSend : function(xhr) {
												xhr.setRequestHeader(header,
														token)
											},
											dataType : 'json',
											data : {
												categoryId : categoryId,
												userNo : userNo,
												boardNo : boardNo
											},
											success : function(data, idx, arr) {
												console.log(arr);

												alert("스크랩이 성공 적 으로 등록 되었습니다.")

											}
										})

									})
						</script>
						<!-- 스크랩 스크립트 시작 20221005 소현 끝  -->



						<!--product info start-->
						<div class="product_d_info mb-118">
							<div class="container">
								<div class="row">
									<div class="col-12">
										<div class="product_d_inner">

											<!-- 클래스 목차 메뉴바 -->
											<div class="product_info_button border-bottom">
												<ul class="nav" role="tablist">
													<li><a data-toggle="tab" href="#additional" role="tab"
														aria-controls="additional" aria-selected="false">업체소개</a></li>
													<li><a data-toggle="tab" href="#reviews" role="tab"
														aria-controls="reviews" aria-selected="false">리뷰</a></li>
													<li><a data-toggle="tab" href="#maps" role="tab"
														aria-controls="maps" aria-selected="false">오시는 길</a></li>
												</ul>
											</div>

											<div class="tab-content">
												<!-- 업체 소개글 -->
												<div class="tab-pane fade show active" id="additional"
													role="tabpanel" th:each="f:${funeral}">
													<div class="product_info_content">
													
														<p>
															슬픔의 처음부터 끝까지<br>
															함께 하겠습니다.<br>
																우리의 이별이 끝없는 슬픔은 아닐 거예요.<br>
															반드시, 다시 만나게 될 거니까요.<br>

															누구에게나 서툴고 낯선 이별의 순간,<br>
															[[${f.name}]]이 처음부터 끝까지 함께 하겠습니다.</p>
													</div>
												</div>

								<!-- 리뷰 -->
								<div class="tab-pane fade" id="reviews" role="tabpanel">
									<div class="reviews_wrapper">
										<h2>[[${#lists.size(reviewSelectList)}]]개의 리뷰가 있습니다.</h2>
										
										<!-- 말풍선 모양 div -->
										<div class="reviews_comment_box" th:each="re:${reviewSelectList}">
											<div class="comment_thmb">
												<img src="assets/img/blog/comment2.jpg" alt="">
											</div>
											<div class="comment_text">
												<div class="reviews_meta">
													<p>
														<strong th:switch="${re.star}">
															<i class="reviewstar" th:case="5">★★★★★</i>
															<i class="reviewstar" th:case="4">★★★★☆</i>
															<i class="reviewstar" th:case="3">★★★☆☆</i>
															<i class="reviewstar" th:case="2">★★☆☆☆</i>
															<i class="reviewstar" th:case="1">★☆☆☆☆</i>
															<i class="reviewstar" th:case="0">☆☆☆☆☆</i>
														</strong><br>
														
														<strong>[[${re.nickname}]]</strong> 
														<a>  [[${re.dt}]]</a>
													</p>
													<span>[[${re.content}]]</span>
												</div>
											</div>
										</div>
										<!-- 말풍선 모양 div -->
										
										<!-- ajax로 댓글 달리는 부분 -->
										<div class="reviews_comment_box" id="ajaxReviewDiv"></div>
										
										
										<div class="product_review_form">	
												<div class="product_ratting mb-10">
													<h2 class="star-txt">별점을 선택해주세요</h2>
													<div class="star-point">
														<i class="fa-star">★</i> <i class="fa-star">★</i> <i
															class="fa-star">★</i> <i class="fa-star">★</i> <i
															class="fa-star">★</i>
													</div>
													
													<!-- 별점 숫자 -->
													<input type="hidden" id="star" name="star" value="0" />
													
													
		
												</div>
											
												<div class="row">
													<div class="comment_title col-12">
														<h2>업체리뷰를 작성해주세요</h2>
														<!-- 말풍선 모양 div -->
														<div class="reviews_comment_box">
															<div class="comment_thmb">
																<img src="assets/img/blog/comment2.jpg" alt="">
															</div>
															<div class="comment_text">
																<div class="reviews_meta">
																	<p>
																		<strong th:value="${session.user.nickname}"></strong> 
																	</p>
																	<span>
																		<textarea id="reviewcontent" name="content" rows="8" cols="8" style="border:none;"></textarea>
																	</span>
																</div>
															</div>
															<button id="reviewbtn" type="button">작성하기</button>
														</div>
														<!-- 말풍선 모양 div -->
													</div>
												</div>
										    </div>
									    </div>
								   </div>

												<!-- 오시는길 -->
												<div class="tab-pane fade" id="maps" role="tabpanel">
													<div class="product_d_table">
														<form action="#">
															<input type="hidden" name="latitude" id="latitude"
																th:value="${funeral.latitude}"> <input
																type="hidden" name="longitude" id="longitude"
																th:value="${funeral.longitude}">
															<table>
																<tbody>
																	<tr>
																		<td class="first_child">주소</td>
																		<td>[[${funeral.address}]]</td>
																	</tr>
																</tbody>
															</table>
															<br>

															<div id="map"
																style="width: auto; height: 400px; margin: auto;"></div>
															<script type="text/javascript"
																src="//dapi.kakao.com/v2/maps/sdk.js?appkey=a32d865cd3140bd47b21a6e22
																a6e05b0&libraries=services,clusterer,drawing">
																
															</script>
															<script>
																var latitude = $(
																		'#latitude')
																		.val(); //x축
																var longitude = $(
																		'#longitude')
																		.val(); //y축
																var mapContainer = document
																		.getElementById('map'), // 지도를 표시할 div 
																mapOption = {
																	center : new daum.maps.LatLng(
																			latitude,
																			longitude), // 지도의 중심좌표
																	level : 3
																// 지도의 확대 레벨
																};

																//지도를 미리 생성
																var map = new daum.maps.Map(
																		mapContainer,
																		mapOption);
																//주소-좌표 변환 객체를 생성
																var geocoder = new daum.maps.services.Geocoder();
																//마커를 미리 생성
																var marker = new daum.maps.Marker(
																		{
																			position : new daum.maps.LatLng(
																					latitude,
																					longitude),
																			map : map
																		});
															</script>
														</form>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
						<!--product info end-->


						<div class="btnn">
							<button type="button" class="btn btn-primary"
								onclick="location.href='funeralList'">목록</button>
						</div>

					</div>
				</div>


			</div>
		</div>

		<script>
		
		
		/*-----------------------
		//댓글 작성
		-------------------------*/				
		$('#reviewbtn').on("click", function() {
				var token = $("meta[name='_csrf']").attr("content");
				var header = $("meta[name='_csrf_header']").attr("content");
			
				var title = "업체후기";
				var content = $("#reviewcontent").val();
				var star = $("#star").val();
				var boardNo = $("#funeralNo").val();
				var categoryId = "f";
				var groupNo = 1;
				var userNo = $("#userNo").val();

			 	$.ajax({
						url : "funeralReviewInsert",
						type:'post',
						beforeSend: function (xhr) {
							xhr.setRequestHeader(header, token)
						},
						data : {
								title:title,
								content:content,
								star:star,
								boardNo: boardNo,
								categoryId:categoryId,
								groupNo:groupNo,
								userNo:userNo
								},
						success : function(result){
							$("#ajaxReviewDiv").append(
								`<div class="comment_thmb">
											<img src="assets/img/blog/comment2.jpg" alt="">
								</div>
								<div class="comment_text">
											<div class="reviews_meta">
												<p>
													<strong id="starbox">
													</strong><br>
													
													<strong>${result.nickname}</strong> 
													<a> ${result.dt}</a>
												</p>
												<span>${result.content}</span>
											</div>
										</div>
								</div>`
							);
							
							var rank = `${result.star}`
							console.log(rank)
							
							if(rank == 5) {
								$("#starbox").append(`<i class="reviewstar">★★★★★</i>`);
							} else if(rank ==4) {
								$("#starbox").append(`<i class="reviewstar">★★★★☆</i>`);
							} else if(rank ==3) {
								$("#starbox").append(`<i class="reviewstar">★★★☆☆</i>`);
							} else if(rank ==2) {
								$("#starbox").append(`<i class="reviewstar">★★☆☆☆</i>`);
							} else if(rank ==1) {
								$("#starbox").append(`<i class="reviewstar">★☆☆☆☆</i>`);
							} else if(rank ==0) {
								$("#starbox").append(`<i class="reviewstar">☆☆☆☆☆</i>`);
							}

							alert("리뷰가 성공적으로 작성되었습니다.")
						
						},
						error : function(result){
							alert("리뷰를 작성하는데 실패했습니다.")
						}
				}); 
			 	
		})
		</script>


	</article>
</body>
</html>