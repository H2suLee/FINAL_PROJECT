<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/layout_admin}">

<head>
<meta charset="UTF-8">
<meta id="_csrf" name="_csrf" th:content="${_csrf.token}" />
<meta id="_csrf_header" name="_csrf_header"
	th:content="${_csrf.headerName}" />

<script
	src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script type="text/javascript"
	src="https://cdn.datatables.net/1.10.23/js/jquery.dataTables.min.js"></script>
<link rel="stylesheet" type="text/css"
	href="https://cdn.datatables.net/1.10.23/css/jquery.dataTables.min.css" />
<script
	src="https://cdn.datatables.net/buttons/1.5.1/js/dataTables.buttons.min.js"></script>
<script
	src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
<script
	src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.32/pdfmake.min.js"></script>
<script
	src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.32/vfs_fonts.js"></script>
<script
	src="https://cdn.datatables.net/buttons/1.5.1/js/buttons.html5.min.js"></script>
<script
	src="https://cdn.datatables.net/buttons/1.5.1/js/buttons.print.min.js"></script>

<title>Insert title here</title>
</head>

<body>
	<article layout:fragment="content">
		<!-- Profit Card -->
		<div class="container-xxl flex-grow-1 container-p-y">
			<div class="row">
				<div class="col-xl-12">
					<div class="row">
						<div class="col-xs-6 col-sm-3">
							<div class="card">
								<div class="card-body">
									<div
										class="card-title d-flex align-items-start justify-content-between">
										<div class="avatar flex-shrink-0">
											<img src="/admin/assets/img/icons/unicons/chart-success.png"
												alt="chart success" class="rounded" />
										</div>
										<div class="dropdown">
											<button class="btn p-0" type="button" id="cardOpt3"
												data-bs-toggle="dropdown" aria-haspopup="true"
												aria-expanded="false">
												<i class="bx bx-dots-vertical-rounded"></i>
											</button>
											<div class="dropdown-menu dropdown-menu-end"
												aria-labelledby="cardOpt3">
												<a class="dropdown-item" href="javascript:void(0);">View
													More</a> <a class="dropdown-item" href="javascript:void(0);">Delete</a>
											</div>
										</div>
									</div>
									<span class="fw-semibold d-block mb-1">어제 매출 합계</span>
									<h3 class="card-title mb-2">$12,628</h3>
									<small class="text-success fw-semibold"><i
										class="bx bx-up-arrow-alt"></i> +72.80%</small>
								</div>
							</div>
						</div>
						<div class="col-xs-6 col-sm-3">
							<div class="card">
								<div class="card-body">
									<div
										class="card-title d-flex align-items-start justify-content-between">
										<div class="avatar flex-shrink-0">
											<img src="/admin/assets/img/icons/unicons/chart.png"
												alt="Credit Card" class="rounded" />
										</div>
										<div class="dropdown">
											<button class="btn p-0" type="button" id="cardOpt6"
												data-bs-toggle="dropdown" aria-haspopup="true"
												aria-expanded="false">
												<i class="bx bx-dots-vertical-rounded"></i>
											</button>
											<div class="dropdown-menu dropdown-menu-end"
												aria-labelledby="cardOpt6">
												<a class="dropdown-item" href="javascript:void(0);">View
													More</a> <a class="dropdown-item" href="javascript:void(0);">Delete</a>
											</div>
										</div>
									</div>
									<span>지난 주 매출 합계</span>
									<h3 class="card-title text-nowrap mb-1">$4,679</h3>
									<small class="text-success fw-semibold"><i
										class="bx bx-up-arrow-alt"></i> +28.42%</small>
								</div>
							</div>
						</div>
						<div class="col-xs-6 col-sm-3">
							<div class="card">
								<div class="card-body">
									<div
										class="card-title d-flex align-items-start justify-content-between">
										<div class="avatar flex-shrink-0">
											<img src="/admin/assets/img/icons/unicons/cc-success.png"
												alt="Credit Card" class="rounded" />
										</div>
										<div class="dropdown">
											<button class="btn p-0" type="button" id="cardOpt6"
												data-bs-toggle="dropdown" aria-haspopup="true"
												aria-expanded="false">
												<i class="bx bx-dots-vertical-rounded"></i>
											</button>
											<div class="dropdown-menu dropdown-menu-end"
												aria-labelledby="cardOpt6">
												<a class="dropdown-item" href="javascript:void(0);">View
													More</a> <a class="dropdown-item" href="javascript:void(0);">Delete</a>
											</div>
										</div>
									</div>
									<span>지난 달 매출 합계</span>
									<h3 class="card-title text-nowrap mb-1">$4,679</h3>
									<small class="text-success fw-semibold"><i
										class="bx bx-up-arrow-alt"></i> +28.42%</small>
								</div>
							</div>
						</div>
						<div class="col-xs-6 col-sm-3">
							<div class="card">
								<div class="card-body">
									<div
										class="card-title d-flex align-items-start justify-content-between">
										<div class="avatar flex-shrink-0">
											<img src="/admin/assets/img/icons/unicons/cc-primary.png"
												alt="chart success" class="rounded" />
										</div>
										<div class="dropdown">
											<button class="btn p-0" type="button" id="cardOpt3"
												data-bs-toggle="dropdown" aria-haspopup="true"
												aria-expanded="false"></button>
											<div class="dropdown-menu dropdown-menu-end"
												aria-labelledby="cardOpt3">
												<a class="dropdown-item" href="javascript:void(0);">View
													More</a> <a class="dropdown-item" href="javascript:void(0);">Delete</a>
											</div>
										</div>
									</div>
									<span class="fw-semibold d-block mb-1">올해 누적 매출</span>
									<h3 class="card-title mb-2">123,456,789원</h3>
									<small class="text-success fw-semibold"><i
										class="bx bx-up-arrow-alt"></i> +0%</small>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<!-- /Profit Card -->
		<!-- Profit Overview -->
		<div class="row">
			<div class="col-xl-12">
				<div class="nav-align-top mb-4">
					<ul class="nav nav-pills mb-3" role="tablist">
						<li class="nav-item">
							<button type="button" class="nav-link active" role="tab"
								data-bs-toggle="tab" data-bs-target="#dailyTab"
								aria-controls="navs-pills-top-home" aria-selected="true">
								일간</button>
						</li>
						<li class="nav-item">
							<button type="button" class="nav-link" role="tab"
								data-bs-toggle="tab" data-bs-target="#weeklyTab"
								aria-controls="navs-pills-top-profile" aria-selected="false">
								주간</button>
						</li>
						<li class="nav-item">
							<button type="button" class="nav-link" role="tab" id="monthlyBtn"
								data-bs-toggle="tab" data-bs-target="#monthlyTab"
								aria-controls="navs-pills-top-messages" aria-selected="false">
								월간</button>
						</li>
					</ul>
					<div class="tab-content">
						<div class="tab-pane fade show active" id="dailyTab"
							role="tabpanel">
							<div class="card h-100">
								<div class="card-body px-0">
									<div class="tab-content p-0">
										<div class="tab-pane fade show active"
											id="navs-tabs-line-card-income" role="tabpanel">
											<div class="d-flex p-4 pt-3">
												<div class="avatar flex-shrink-0 me-3">
													<img src="/admin/assets/img/icons/unicons/wallet.png"
														alt="User" />
												</div>
												<div>
													<small class="text-muted d-block">최근 30일 간의 일간
														차트입니다.</small>
												</div>
											</div>
											<div id="dailyIncomeChart">
												<div id="curve_chart" style="width: 100%; height: 500px"></div>
											</div>

											<!-- Profit Table -->
											<br> <br> <br>
											<div class="daily"
												style="width: 80%; height: auto; margin: 5px auto;">
												<table id="daily" class="table">
													<thead>
														<tr>
															<th>정산일자</th>
															<th>매출(원)</th>

														</tr>
													</thead>
													<tbody>
														<tr class="days" th:each="d:${dailyList}">
															<td>[[${d.DAILY}]]</td>
															<td>[[${d.PF}]]</td>
														</tr>
													</tbody>
												</table>
											</div>

											<!-- /Profit Table -->
										</div>
									</div>
								</div>
							</div>
						</div>
						<div class="tab-pane fade" id="weeklyTab" role="tabpanel">
							<div class="card h-100">
								<div class="card-body px-0">
									<div class="tab-content p-0">
										<div class="tab-pane fade show active"
											id="navs-tabs-line-card-income" role="tabpanel">
											<div class="d-flex p-4 pt-3">
												<div class="avatar flex-shrink-0 me-3">
													<img src="/admin/assets/img/icons/unicons/wallet.png"
														alt="User" />
												</div>
												<div>
													<small class="text-muted d-block">주간 
														차트입니다.</small>
												</div>
											</div>
											<div id="weeklyIncomeChart">
												
											</div>
											<!-- Profit Table -->
											<br> <br> <br>
											<div class="weekly" style="width: 80%; margin: 5px auto;">
												<table id="weekly" class="table">
													<thead>
														<tr>
															<th style="display: none">정산일자(일)</th>
															<th>정산일자(일)</th>
															<th>정산일자(토)</th>
															<th>매출(원)</th>

														</tr>
													</thead>
													<tbody>
														<tr th:each="w:${weeklyList}">
															<td style="display: none">[[${w.WEEKLY}]]</td>
															<td>[[${w.START_DT}]]</td>
															<td>[[${w.END_DT}]]</td>
															<td>[[${#numbers.formatInteger(w.PF,3,'COMMA')}]]</td>
														</tr>
													</tbody>
												</table>
											</div>

											<!-- /Profit Table -->
										</div>
									</div>
								</div>
							</div>
						</div>
						<div class="tab-pane fade" id="monthlyTab" role="tabpanel">
							<div class="card h-100">
								<div class="card-body px-0">
									<div class="tab-content p-0">
										<div class="tab-pane fade show active"
											id="navs-tabs-line-card-income" role="tabpanel">
											<div class="d-flex p-4 pt-3">
												<div class="avatar flex-shrink-0 me-3">
													<img src="/admin/assets/img/icons/unicons/wallet.png"
														alt="User" />
												</div>
												<div>
													<small class="text-muted d-block">올해 월간 차트입니다.</small>
												</div>
											</div>
											<div id="monthlyIncomeChart">
												
											</div>
											<!-- Profit Table -->
											<br> <br> <br>
											<div class="monthly" style="width: 80%; margin: 5px auto;">
												<table id="monthly" class="table">
													<thead>
														<tr>
															<th>정산일자</th>
															<th>매출(원)</th>

														</tr>
													</thead>
													<tbody>
														<tr class="mnths" th:each="m:${monthlyList}">
															<td>[[${m.MONTHLY}]]</td>
															<td>[[${#numbers.formatInteger(m.PF,3,'COMMA')}]]</td>
														</tr>
													</tbody>
												</table>
											</div>

											<!-- /Profit Table -->
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>

		</div>
		<!--/ Profit Overview -->
		<script type="text/javascript"
			src="https://www.gstatic.com/charts/loader.js"></script>
		<script type="text/javascript">
			/* <div id="curve_chart" style="width: 100%; height: 500px"></div> */

			
			let arrs = [];
			arrs = dailyChart();
		$('#monthlyBtn').on('click', function() {
			$('#dailyIncomeChart').html('');
			$('#weeklyIncomeChart').html('');
			$('#monthlyIncomeChart').append('<div id="curve_chart" style="width: 100%; height: 500px"></div>')
			arrs = monthlyChart();	
			google.charts.setOnLoadCallback(drawChart);
			})
			
		function monthlyChart(){
				let f = ['Monthly', 'Profit'];
				arrs.push(f);
				
				let today = new Date();
				month = Number(today.toISOString().substr(0,5,2));
				
				console.log('month', today.toISOString().substr(0,5,2));
				
				let mnths = $('.mnths');
				for(i=month-3; i<month; i++){
					let arr = [];
					arr[0] = i;
					for(mnth of mnths){
						let m = mnth.children[0].innerHTML;
						let p = Number(mnth.children[1].innerHTML);
						console.log('m', m);
						console.log('p', p);
						
						if(m==i){
							arr[1] = p;
							break;
						}else{
							arr[1] = 0;
						}
					}
					console.log('arr', arr);
					arrs.push(arr);
				}
				console.log('ars', arrs);
				return arrs;
			}
			
		function dailyChart(){
			let f = ['Daily', 'Profit'];
			arrs.push(f);
		
			let today = new Date();
			today = new Date(today.setMonth(today.getMonth() - 1));
			
		
			let days = $('.days');
			
				for(i=1; i<32; i++){
					today.setDate(today.getDate()+1);
					t = today.toISOString().substr(0, 10);
					let arr = [];					
					arr[0] = t;
					for(day of days){
						
						let d = day.children[0].innerHTML;
						let p = Number(day.children[1].innerHTML);
						if(d==t){
							arr[1] = p;
							break;
						}else{
							arr[1] = 0;
						}
					}
					arrs.push(arr);
				}
				return arrs;
			}
			
			
			/* Google Chart */
		
			google.charts.load('current', {
				'packages' : [ 'corechart' ]
			});
			google.charts.setOnLoadCallback(drawChart);

			function drawChart() {
				console.log('>>>', arrs);
				var data = google.visualization.arrayToDataTable(arrs);
				
				var options = {
					title : 'Company Performance',
					curveType : 'function',
					legend : {
						position : 'bottom'
					}
				};

				var chart = new google.visualization.LineChart(document
						.getElementById('curve_chart'));

				chart.draw(data, options);
			}
			
			/* DataTables */

			$('#daily').DataTable({
				lengthChange : false,
				pageLength : 10,
				lengthMenu : [ 10, 20, 30, 40, 50 ],
				info : true,
				searching : false,
				ordering : false,
			});
			$('#weekly').DataTable({
				lengthChange : false,
				pageLength : 10,
				lengthMenu : [ 10, 20, 30, 40, 50 ],
				info : true,
				searching : false,
				ordering : false,
			});
			$('#monthly').DataTable({
				lengthChange : false,
				pageLength : 10,
				lengthMenu : [ 10, 20, 30, 40, 50 ],
				info : true,
				searching : false,
				ordering : false,
			});
		</script>
	</article>
</body>
</html>