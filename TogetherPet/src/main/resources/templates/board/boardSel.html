<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/layout}">
<meta name="_csrf" th:content="${_csrf.token}" />
<meta name="_csrf_header" th:content="${_csrf.headerName}" />
<head>
<meta charset="UTF-8">
<title>커뮤니티 상세보기</title>



<script th:inline="javascript">


$(document).ready(function() {
	//삭제버튼
	$("#btnd").on('click', e=>{
		$("#frmd").submit();
	})
	
})
</script>

<style>
* {
	margin: 0;
	padding: 0;
}

html {
	font-size: 10px;
}

ul, li {
	list-style: none;
}

a {
	text-decoration: none;
	color: inherit;
}

.board_wrap {
	width: 1000px;
	margin: 100px auto;
}

.board_title {
	margin-bottom: 30px;
}

.board_title strong {
	font-size: 3rem;
}

.board_title p {
	margin-top: 5px;
	font-size: 1.4rem;
}

.bt_wrap {
	margin-top: 30px;
	text-align: center;
	font-size: 0;
}

.bt_wrap a {
	display: inline-block;
	min-width: 80px;
	margin-left: 10px;
	padding: 10px;
	border: 1px solid #000;
	border-radius: 2px;
	font-size: 1.4rem;
}

.bt_wrap a:first-child {
	margin-left: 0;
}

.bt_wrap a.on {
	background: #000;
	color: #fff;
}

.board_list {
	width: 100%;
	border-top: 2px solid #000;
}

.board_list>div {
	border-bottom: 1px solid #ddd;
	font-size: 0;
}

.board_list>div.top {
	border-bottom: 1px solid #999;
}

.board_list>div:last-child {
	border-bottom: 1px solid #000;
}

.board_list>div>div {
	display: inline-block;
	padding: 15px 0;
	text-align: center;
	font-size: 1.4rem;
}

.board_list>div.top>div {
	font-weight: 600;
}

.board_list .num {
	width: 10%;
}

.board_list .title {
	width: 60%;
	text-align: left;
}

.board_list .top .title {
	text-align: center;
}

.board_list .writer {
	width: 10%;
}

.board_list .date {
	width: 10%;
}

.board_list .count {
	width: 10%;
}

.board_page {
	margin-top: 30px;
	text-align: center;
	font-size: 0;
}

.board_page a {
	display: inline-block;
	width: 32px;
	height: 32px;
	box-sizing: border-box;
	vertical-align: middle;
	border: 1px solid #ddd;
	border-left: 0;
	line-height: 100%;
}

.board_page a.bt {
	padding-top: 10px;
	font-size: 1.2rem;
	letter-spacing: -1px;
}

.board_page a.num {
	padding-top: 9px;
	font-size: 1.4rem;
}

.board_page a.num.on {
	border-color: #000;
	background: #000;
	color: #fff;
}

.board_page a:first-child {
	border-left: 1px solid #ddd;
}

.board_view {
	width: 100%;
	border-top: 2px solid #000;
}

.board_view .title {
	padding: 20px 15px;
	border-bottom: 1px dashed #ddd;
	font-size: 2rem;
}

.board_view .info {
	padding: 15px;
	border-bottom: 1px solid #999;
	font-size: 0;
}

.board_view .info dl {
	position: relative;
	display: inline-block;
	padding: 0 20px;
}

.board_view .info dl:first-child {
	padding-left: 0;
}

.board_view .info dl::before {
	content: "";
	position: absolute;
	top: 1px;
	left: 0;
	display: block;
	width: 1px;
	height: 13px;
	background: #ddd;
}

.board_view .info dl:first-child::before {
	display: none;
}

.board_view .info dl dt, .board_view .info dl dd {
	display: inline-block;
	font-size: 1.4rem;
}

.board_view .info dl dt {
	
}

.board_view .info dl dd {
	margin-left: 10px;
	color: #777;
}

.board_view .cont {
	padding: 15px;
	border-bottom: 1px solid #000;
	line-height: 160%;
	font-size: 1.4rem;
}

.board_write {
	border-top: 2px solid #000;
}

.board_write .title, .board_write .info {
	padding: 15px;
}

.board_write .info {
	border-top: 1px dashed #ddd;
	border-bottom: 1px solid #000;
	font-size: 0;
}

.board_write .title dl {
	font-size: 0;
}

.board_write .info dl {
	display: inline-block;
	width: 50%;
	vertical-align: middle;
}

.board_write .title dt, .board_write .title dd, .board_write .info dt,
	.board_write .info dd {
	display: inline-block;
	vertical-align: middle;
	font-size: 1.4rem;
}

.board_write .title dt, .board_write .info dt {
	width: 100px;
}

.board_write .title dd {
	width: calc(100% - 100px);
}

.board_write .title input[type="text"], .board_write .info input[type="text"],
	.board_write .info input[type="password"] {
	padding: 10px;
	box-sizing: border-box;
}

.board_write .title input[type="text"] {
	width: 80%;
}

.board_write .cont {
	border-bottom: 1px solid #000;
}

.board_write .cont textarea {
	display: block;
	width: 100%;
	height: 300px;
	padding: 15px;
	box-sizing: border-box;
	border: 0;
	resize: vertical;
}

.btnn {
	text-align: center;
}

.cont {
	min-height: 500px;
}

.review-reply-btn {
	width: 50px;
	height: 36px;
	margin-left: 14px;
	border: none;
	background-color: #000000;
	color: #fff;
	border-radius: 5px;
	cursor: pointer;
}

.review-reply {
	width: 950px;
	min-height: 50px;
	border: 1px solid #ddd;
	border-radius: 5px;
	padding: 6px 10px;
	resize: none;
}

#rBtn {
	left: 700px;
}
</style>
</head>
<body>
	<article layout:fragment="content">
		<!--shop  area start-->
		<div class="shop_section shop_reverse">
			<div class="container">
				<div class="row">
					<div class="col-lg-12 col-md-12">

						<!--breadcrumbs area start-->
						<div class="breadcrumb_content" style="margin: 50px;">
							<ul>
								<li><a href="index.html">home</a></li>
								<li>커뮤니티</li>
								<li>자유게시판</li>
							</ul>
						</div>
						<!--breadcrumbs area end-->

						<div class="shop_banner d-flex align-items-center"
							data-bgimg="assets/img/bg/pexels-photo-59523.jpeg">
							<div class="shop_banner_text">
								<h2>
									essential <br> for my pets
								</h2>
								<p>
									The collections basic items <br> essential for all pets
								</p>
							</div>
						</div>

						<div class="board_wrap">
							<div class="board_title">
								<strong>반려동물 이야기 및 마이펫 자랑</strong> <br> <br>
								<p>자유로운 토크 커뮤니티입니다!</p>
								<br>
							</div>
							<div class="board_view_wrap">
								<div class="board_view">
									<div class="title" th:text="${boardSel.title}">글 제목이
										들어갑니다.</div>
									<div class="info">
										<dl>
											<dt>번호</dt>
											<dd th:text="${boardSel.boardNo}">1</dd>
										</dl>
										<dl>
											<dt>글쓴이</dt>
											<dd th:text="${boardSel.nickname}">김이름</dd>
										</dl>
										<dl>
											<dt>작성일</dt>
											<dd th:text="${boardSel.dt}">2021.1.16</dd>
										</dl>
										<dl>
											<dt>조회</dt>
											<dd th:text="${boardSel.hit}">33</dd>
										</dl>

										<dl>
											<dt>
												<img class="primary_img" src="assets/img/likes/458534.png"
													alt="consectetur" width="15" height="15">
											</dt>
											<dd th:text="${boardSel.likes}">33</dd>
										</dl>

										<br>
										<dl>
											<dt>첨부파일</dt>
											<dd>
												<a th:href="@{/download(fileName=${boardSel.attechDir})}"
													th:text="${boardSel.attech}">33</a>
											</dd>
										</dl>


									</div>
									<div class="cont">[(${boardSel.content})]</div>

								</div>


								<br> <br> <br>
								<div class="btnn">
									<button
										th:if="${#authentication.principal.login.no == boardSel.userNo}"
										type="button" class="btn btn-primary" id="btnd"
										th:value="${#authentication.principal.login.no}"
										onClick="alert('삭제하시겠습니까?')">삭제</button>
									<a href="boardList" class="btn btn-primary">목록</a> <a
										th:href="@{boardUpdateForm(boardNo=${boardSel.boardNo})}">
										<button
											th:if="${#authentication.principal.login.no == boardSel.userNo}"
											type="button" class="btn btn-primary" id="btnm"
											th:value="${#authentication.principal.login.no}"
											onClick="alert('수정하시겠습니까?')">수정</button>
									</a>

								</div>

								<br />

							</div>



							<!-- start 댓글 -->
							<div class="card-header">댓글[[
								${#lists.size(commentSelectList)} ]]건</div>

							<div class="card mb-2 mt-5">
								<div class="card-header bg-light">
									<i class="fa fa-comment fa"></i> 댓글
								</div>

								<div class="card-body" th:if="${#authentication.principal.login.author == 'ROLE_USER'}">
									<ul class="list-group list-group-flush">
										<li class="list-group-item"><textarea
												class="review-reply" id="content" name="content" rows="5"
												style="resize: none;"></textarea></li>
									</ul>
									<br>
									<div >
										<input type="text" id="nickname" name="nickname"
											th:value="${session.user.nickname}" readonly="readonly">
									</div>
									<button type="button" id="rBtn" class="btn btn-primary">등록</button>
									<br>
								</div>

								<!-- 전체 댓글 -->
								<div id="rList" >
									<div th:each="c : ${commentSelectList}">
										<span th:text="${c.nickname}">작성자</span>&nbsp; <br> <span
											th:text="${c.content}">댓글내용</span>&nbsp;&nbsp; <span
											th:text="${c.dt}">작성일자</span>&nbsp;&nbsp;
										<hr>
									</div>

									<hr>
								</div>
							</div>

							<!-- end 댓글 -->
						</div>

						<!-- 수정 삭제관련 form 시작-->
						<div>
							<form id="frmd" action="boardDelete" method="post">
								<input type="hidden" th:name="${_csrf.parameterName}"
									th:value="${_csrf.token}"> <input type="number"
									id="boardNo" name="boardNo" style="display: none"
									th:value="${boardSel.boardNo}">
							</form>
						</div>
						<!-- 수정 삭제관련 form 끝-->

					</div>
				</div>
			</div>
		</div>

		</div>



		<script type="text/javascript">

		let csrfHeaderName = $("meta[name='_csrf']").attr("content");
		let csrfTokenValue = $("meta[name='_csrf_header']").attr("content");
		
		
		let header = $("input[name='_csrf']").val();
		console.log(header)
		let csrfToken = $("input[name='_csrf_token']").val();
		console.log(csrfToken)
		
		//==============댓글==============
		//댓글 등록 버튼 클릭시
		$("#rBtn").on("click", e=>{
			let boardNo = $("#boardNo").val(); //게시글 번호
				console.log(boardNo);
			let content = $("#content").val();    //댓글 내용
				console.log(content);
			let userNo = $("#userNo").val();   //댓글 쓴 사원번호
				console.log(userNo);
			let nickname =$("#nickname").val(); //댓글 쓴 사람 닉네임
				console.log(nickname);
			let SelectList = $("<div>").attr("id", "SelectList"); 
						//댓글 등록 처리
			$.ajax({
		         url:'/commentInsert.do',
		         type:'post',
		         beforeSend:function(xhr){
		 			//xhr.setRequestHeader(csrfHeaderName,csrfTokenValue);
		        	 xhr.setRequestHeader("AJAX", true);
		 		     xhr.setRequestHeader("X-CSRF-TOKEN", header);
		     	  }, 
		     	 dataType:'json',
		         data:{'boardNo':boardNo, 'content':content, 'userNo':userNo, 'nickname':nickname},
		         success:function(data,idx,arr){
				console.log(arr); 
				if(data == 1){
					alert("댓글이 성공 적 으로 등록 되었습니다.")
					location.href="boardSel?boardNo="+boardNo 
							
			function commentSelectList(){
						$.ajax({ 
							url : "commentSelectList.do",
							type : "get",
							data : {'boardNo' : boardNo},
							beforeSend: function(xhr){
								xhr.setRequestHeader("AJAX", true);
							    xhr.setRequestHeader("X-CSRF-TOKEN", csrfToken);
							},
							success : function(data){
								//console.log(data);
								data.forEach(element=>{
									$("#rList").append(makeTr(element));
								})
							}
						})
					} 
					function makeTr(data){
		        	 let div = $("<div>").append($("<span>").html(res.cwriter)).append("")
											.append($("<span>").html(res.dt))
											.append($("<br>"))
											.append($("<span>").html(res.content)).append("")
											.append($("<span>").html(res.dt)).append("")
											.append($("<span>").append($("<i>").addClass("ri-edit-2-line update")
													.attr("data-no", res.commentNo)).append(""))
											.append($("<span>").append($("<i>").addClass("ri-delete-bin-line delete")
													.attr("data-no", res.commentNo)))
											.append($("<hr>"))
						$("#rList").append(div);
					}
				}
		       }
		    })
		});
		
		
		

		</script>
	</article>


</body>
</html>