<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.team.prj.users.mapper.UsersMapper">
	<select id="usersSelectList"
		resultType="com.team.prj.users.service.UsersVO">
		SELECT * FROM USERS
	</select>

	<!-- 주문 내역 불러오기 -->
	<select id="orderList"
		parameterType="com.team.prj.goods.service.GoodsVO"
		resultType="com.team.prj.orders.service.OrderVO">
		select *
		from orders o, goods g
		where o.goods_no = g.goods_no
		and o.user_no = #{userNo}
		order by order_no desc
	</select>

	<!-- 장바구니 내역 조회 -->
	<select id="cartList"
		resultType="com.team.prj.cart.service.CartVO">
		select *
		from goods g, cart c
		where g.goods_no = c.goods_no
		and c.user_no = #{userNo}
	</select>

	<!-- 수강 내역 조회 -->
	<select id="classList"
		parameterType="com.team.prj.tutor.service.TutorVO"
		resultType="com.team.prj.classreserve.service.ClassReserveVO">
		SELECT c.name, t.name as t_name, cr.dt, cr.pay, c.address
		FROM class c, tutor t, class_reserve cr
		WHERE t.tutor_no = c.tutor_no
		AND c.class_no = cr.class_no
		AND cr.user_no = #{userNo}
	</select>

	<!-- 사진 불러오기 -->
	<select id="photoList"
		parameterType="com.team.prj.goods.service.GoodsVO"
		resultType="com.team.prj.photo.service.PhotoVO">
		select *
		from photo
		where group_no = #{groupNo}
		and name =
		'리스트'
	</select>

	<!-- 회원 조회 -->
	<select id="usersSelect"
		parameterType="com.team.prj.users.service.UsersVO"
		resultType="com.team.prj.users.service.UsersVO">
		SELECT * FROM USERS WHERE user_no = #{userNo}
	</select>

	<!-- 회원 등록 -->
	<insert id="usersInsert"
		parameterType="com.team.prj.users.service.UsersVO">
		<selectKey keyProperty="userNo" order="BEFORE"
			resultType="int">
			SELECT
			CASE WHEN max(user_no) IS NULL
			THEN 1
			ELSE
			max(user_no) + 1
			END AS no
			FROM users
		</selectKey>

		INSERT INTO USERS
		VALUES(#{userNo}
		,#{id}
		,#{password}
		,#{name}
		,#{nickname}
		,#{email}
		,#{call}
		,#{address}
		,'USER'
		,3000
		,1
		,SYSDATE
		,'1')
	</insert>

	<!-- 회원 수정 -->
	<update id="usersUpdate"
		parameterType="com.team.prj.users.service.UsersVO">
		UPDATE USERS
		<set>
			<if test="nickname != null">nickname = #{nickname},</if>
			<if test="password != null">password = #{password},</if>
			<if test="email != null">email = #{email},</if>
			<if test="call != null">call = #{call},</if>
			<if test="address != null">address = #{address}</if>
		</set>
		WHERE user_no = #{userNo}
	</update>

	<!-- 회원 삭제 -->
	<delete id="usersDelete">
		DELETE FROM USERS WHERE user_no = #{userNo}
	</delete>

</mapper>