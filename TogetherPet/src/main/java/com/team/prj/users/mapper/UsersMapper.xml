<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.team.prj.users.mapper.UsersMapper">
	<select id="usersSelectList"
		resultType="com.team.prj.users.service.UsersVO">
		SELECT * FROM USERS
	</select>
	
	<!-- 주문 내역 불러오기 -->
	<select id="orderList" resultType="com.team.prj.orders.service.OrderVO">
		select * from orders
		where user_no = #{userNo}
	</select>

	<!-- 장바구니 내역 조회 -->
	<select id="cartList"
		resultType="com.team.prj.cart.service.CartVO">
		select *
		from goods g, cart c
		where g.goods_no = c.goods_no
		and c.user_no = #{userNo}
	</select>
	
	<!-- 사진 불러오기 -->
	<select id="photoList" resultType="com.team.prj.photo.service.PhotoVO">
		select * from photo
		where group_no = #{groupNo}
	</select>
	
	<select id="usersSelect"
		parameterType="com.team.prj.users.service.UsersVO"
		resultType="com.team.prj.users.service.UsersVO">
		SELECT * FROM USERS WHERE user_no = #{userNo}
	</select>

	<insert id="usersInsert"
		parameterType="com.team.prj.users.service.UsersVO">
		<selectKey keyProperty="userNo" order="BEFORE"
			resultType="int">
			SELECT
			CASE WHEN max(user_no) IS NULL
			THEN 1
			ELSE max(user_no) + 1
			END AS no
			FROM users
		</selectKey>

		INSERT INTO USERS
		VALUES(#{userNo}
		,#{id}
		,#{password}
		,#{name}
		,#{nickname}
		,#{email}
		,#{call}
		,#{address}
		,'USER'
		,3000
		,1
		,SYSDATE)
	</insert>

	<update id="usersUpdate"
		parameterType="com.team.prj.users.service.UsersVO">
		UPDATE USERS
		<!-- SET nickname = #{nickname}
			,password = #{password}
			,email = #{email}
			,call = #{call}
			,address = #{address} -->
		<set>
			<if test="nickname != null">nickname = #{nickname},</if>
			<if test="password != null">password = #{password},</if>
			<if test="email != null">email = #{email},</if>
			<if test="call != null">call = #{call},</if>
			<if test="address != null">address = #{address}</if>
		</set>
		WHERE user_no = #{userNo}
	</update>

	<delete id="usersDelete">
		DELETE FROM USERS WHERE user_no = #{userNo}
	</delete>
</mapper>