<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.team.prj.state.mapper.StateMapper">
	<!-- 반품, 교환상태 전체 조회 -->
	<select id="stateSelectList"
		resultType="com.team.prj.state.service.StateVO">
		select * from state
	</select>

	<!-- 단건 조회 -->
	<select id="stateSelect"
		resultType="com.team.prj.state.service.StateVO"
		parameterType="com.team.prj.state.service.StateVO">
		select *
		from state
		where order_no = #{orderNo}
	</select>
	
	<!-- 상태 업데이트
	1 : 반품신청(개인), 2 : 반품신청접수(판매자), 3 : 교환신청(개인), 4 : 교환신청접수(판매자) -->
	<update id="stateUpdate">
		update state
		set state = #{state}
			,cancelDt = #{cancelCfDt}
			,changeDt = #{changeCfDt}
		where order_no = #{orderNo}
	</update>
	
	<!-- 반품 신청 폼에 주문 내역 불러오기 -->
	<select id="orderCanList"
		parameterType="com.team.prj.goods.service.GoodsVO"
		resultType="com.team.prj.orders.service.OrderVO">
		select o.order_no, g.thumb, g.name, o.total_price, o.amount, o.pay, o.delivery_state, o.dt
		from orders o, goods g
		where o.goods_no = g.goods_no
		and o.order_no = #{orderNo}
		order by order_no desc
	</select>
	
	<!-- 반품 신청 처리 -->
	<insert id="cancelInsert" parameterType="com.team.prj.state.service.StateVO">
		insert into state
		values(#{orderNo},
				1,
				sysdate,
				null,
				null,
				null,
				#{cancel},
				#{cancelDetail},
				#{cancelSel},
				#{cancelAccount},
				#{cancelAccountNum},
				null,
				null)
		<!-- values(#{orderNo},
				1,
				sysdate,
				#{cancelCfDt},
				#{changeDt},
				#{changeCfDt},
				#{cancel},
				#{cancelDetail},
				#{cancelSel},
				#{cancelAccount},
				#{cancelAccountNum},
				#{change},
				#{changeDetail}) -->
	</insert>
</mapper>