<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.team.prj.seller.mapper.SellerMapper">
	<select id="sellerSelectList"
		resultType="com.team.prj.seller.service.SellerVO">
		select * from seller
	</select>

	<!-- 판매자 단건 조회 -->
	<select id="sellerMyPage"
		resultType="com.team.prj.seller.service.SellerVO"
		parameterType="com.team.prj.seller.service.SellerVO">
		select *
		from seller
		where seller_no = #{sellerNo}
	</select>

	<!-- 판매자 정보 등록 -->
	<insert id="sellerInsert"
		parameterType="com.team.prj.seller.service.SellerVO">
		<selectKey keyProperty="sellerNo" order="BEFORE"
			resultType="int">
			SELECT
			CASE WHEN max(seller_no) IS NULL
			THEN 1
			ELSE max(seller_no) + 1
			END AS no
			FROM seller
		</selectKey>

		INSERT INTO seller
		VALUES(#{sellerNo}
				,#{id}
				,#{password}
				,#{name}
				,#{company}
				,#{email}
				,#{call}
				,#{address}
				,#{companyNo}
				,#{author}
				,#{groupNo}
				,#{dt})
	</insert>

	<!-- 판매자 정보 수정 -->
	<update id="sellerUpdate"
		parameterType="com.team.prj.seller.service.SellerVO">
		update seller
		<set>
			<if test="id != null">id = #{id},</if>
			<if test="password != null">password = #{password},</if>
			<if test="company != null">company = #{company},</if>
			<if test="email != null">email = #{email},</if>
			<if test="call != null">call = #{call},</if>
			<if test="address != null">address = #{address},</if>
			<if test="companyNo != null">company_no = #{companyNo},</if>
			<if test="dt != null">dt = #{dt},</if>
			<if test="name != null">name = #{name}</if>
		</set>
		where seller_no = #{sellerNo}
	</update>

	<!-- 판매자 삭제 -->
	<delete id="sellerDelete">
		delete from seller
		where seller_no = #{sellerNo}
	</delete>
	
	<!-- 판매자 상품 조회 -->
	<select id="goodsList" resultType="com.team.prj.goods.service.GoodsVO">
		select goods_no, name, upload_state, sell_state, amount
		from goods
		where seller_no = #{sellerNo}
		order by goods_no
	</select>
	
	<!-- 판매자 상품 등록 -->
	<insert id="goodsInsert" parameterType="com.team.prj.goods.service.GoodsVO">
		<selectKey keyProperty="goodsNo" order="BEFORE"
			resultType="int">
			SELECT
			CASE WHEN max(goods_no) IS NULL
			THEN 1
			ELSE max(goods_no)
			+ 1
			END AS no
			FROM goods
		</selectKey>
		
		INSERT INTO GOODS
		VALUES(#{goodsNo},
			#{name},
			#{amount},
			#{category},
			#{price},
			#{info},
			0,
			sysdate,
			0,
			#{hit},
			#{sellerNo},
			0.2,
			's',
			10,
			'상품 등록이 반려되었습니다.',
			#{thumb, jdbcType = VARCHAR},
			#{detail, jdbcType = VARCHAR})
	</insert>
	
	<!-- 사진 불러오기 -->
	<select id="photoList"
		parameterType="com.team.prj.goods.service.GoodsVO"
		resultType="com.team.prj.photo.service.PhotoVO">
		select *
		from photo
		where group_no = #{groupNo}
		and name = '리스트'
	</select>
</mapper>